# Trial Merchant    -*- sh -*-

TRIAL_MERCHANT_HOME="${HOME}/work/runa/trial-merchant"

trial_merchant_check() {
  ls ${TRIAL_MERCHANT_HOME}  >/dev/null 2>&1
}

trial_merchant_install() {
  if trial_merchant_check ; then
    echo "Trial Merchant already installed"
  else
    cd ${HOME}/work/runa
    git clone git@github.com:runa-dev/trial-merchant.git
    cd trial-merchant

    mysql_restart
    sleep 10
    rake db:drop
    rake db:create
    rake db:migrate
  fi
}

trial_merchant_uninstall() {
  rm -rf "${HOME}/work/runa/trial-merchant"
}

trial_merchant_status() {
  curl http://localhost:4000/
}

trial_merchant_start() {
  cd ${TRIAL_MERCHANT_HOME}
  ${SELECT_RUBY}
  if [ 0 -eq $fg ] ; then
    ./script/server -p 4000 &
  else
    ./script/server -p 4000
  fi
}

trial_merchant_stop() {
  pkill -9 -fl -- '-p 4000'
}
