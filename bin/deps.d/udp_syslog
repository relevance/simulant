#  Local Sylog over UDP   -*- sh -*-
#

udp_syslog_check() {
  grep NetworkListener /System/Library/LaunchDaemons/com.apple.syslogd.plist >/dev/null
}

udp_syslog_uninstall() {
   sudo cp /System/Library/LaunchDaemons/com.apple.syslogd.plist.ORIGINAL /System/Library/LaunchDaemons/com.apple.syslogd.plist
}

udp_syslog_install() {
  if udp_syslog_check ; then
    echo "Already configured UDP syslog"
  else
    sudo cp /System/Library/LaunchDaemons/com.apple.syslogd.plist /System/Library/LaunchDaemons/com.apple.syslogd.plist.ORIGINAL
    sudo plutil -convert xml1 /System/Library/LaunchDaemons/com.apple.syslogd.plist
    cat /System/Library/LaunchDaemons/com.apple.syslogd.plist | awk '{ if (match($0, /<key>BSDSystemLogger<\/key>/)) { print "\t\t<key>NetworkListener</key>\n\t\t<dict>\n\t\t\t<key>SockServiceName</key>\n\t\t\t<string>syslog</string>\n\t\t\t<key>SockType</key>\n\t\t\t<string>dgram</string>\n\t\t</dict>"} ; print}' > /tmp/syslogd.plist
    sudo cp /tmp/syslogd.plist /System/Library/LaunchDaemons/com.apple.syslogd.plist
    sudo launchctl unload /System/Library/LaunchDaemons/com.apple.syslogd.plist
    sudo launchctl load /System/Library/LaunchDaemons/com.apple.syslogd.plist
  fi
}

udp_syslog_status() {
  sudo launchctl list com.apple.syslogd
}

udp_syslog_stop() {
  echo
}

udp_syslog_stop() {
  echo
}
