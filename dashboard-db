# Dashboard DB Setup   -*- sh -*-

dashboard_db_check() {
  echo 'select count(*) from users;' | mysql -u root --password=retold-fever runa_dashboard_development && ls config/database.yml
}

dashboard_db_install() {
  if dashboard_db_check ; then
    echo "db already installed"
  else
    cd ${HOME}/work/runa/dashboard
    mysql_restart
    sleep 10

    cp -f config/database.example.yml config/database.yml
    rake db:drop
    rake db:create
    rake db:migrate

    rake db:drop RAILS_ENV=test
    rake db:create RAILS_ENV=test
    rake db:migrate RAILS_ENV=test

    rake data:mock:reset
  fi
}

dashboard_db_uninstall() {
  mysql_restart
  sleep 10

  cp -f config/database.example.yml config/database.yml
  rake db:drop
  rake db:drop RAILS_ENV=test
}

dashboard_db_status() {
  echo "noop" >/dev/null
}

dashboard_db_start() {
  echo "noop" >/dev/null
}

dashboard_db_stop() {
  echo "noop" >/dev/null
}
